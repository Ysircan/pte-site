<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Listening Â· WFD</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root { --bg:#f4f6f9; --card:#fff; --ink:#0b1220; --muted:#6b7280; --brand:#0f62fe }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto;background:var(--bg);color:var(--ink)}
  nav{background:#0b1220;color:#fff;padding:14px 20px;display:flex;gap:28px;justify-content:center}
  nav a{color:#fff;text-decoration:none;font-weight:600;opacity:.9} nav a:hover{opacity:1}
  main{max-width:980px;margin:32px auto;padding:0 20px}
  h1{margin:0 0 8px 0;font-size:40px}
  .muted{color:var(--muted);margin:6px 0 14px}

  .toolbar{display:flex;flex-wrap:wrap;gap:10px;margin:12px 0 18px}
  .tab{border:1px solid #e5e7eb;background:#fff;border-radius:999px;padding:10px 16px;cursor:pointer;font-weight:600}
  .tab.active{background:#0b1220;color:#fff;border-color:#0b1220}

  .card{background:var(--card);border-radius:16px;padding:18px;box-shadow:0 10px 24px rgba(0,0,0,.08)}
  .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  button{padding:10px 16px;border:0;border-radius:10px;background:#111827;color:#fff;cursor:pointer;font-weight:700}
  button.ghost{background:#e5e7eb;color:#111827}
  audio{width:100%}

  #prompt{margin:14px 0 0 0;font-size:22px;line-height:1.7}
  .input-blank{width:100px;max-width:28vw;padding:8px;font-size:18px;margin:0 6px}
  input.full{width:100%;padding:12px 14px;border:1px solid #e5e7eb;border-radius:12px;margin:12px 0;font-size:18px}

  #result{margin-top:10px;font-weight:700}
  #result .answer{color:#065f46}

  #questionNav{margin-top:22px}
  #questionNav .title{font-weight:800;margin-bottom:8px}
  #questionNav .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:8px}
  @media (max-width:720px){ #questionNav .grid{grid-template-columns:repeat(8,1fr)} }
  #questionNav button{height:36px;border-radius:8px;font-weight:800;cursor:pointer;position:relative;overflow:visible}

  /* è¿›åº¦æ¡æ ·å¼ï¼ˆä¿ç•™ï¼‰ */
  .progress {height:8px;background:#e5e7eb;border-radius:999px;margin-top:10px;overflow:hidden}
  .progress > span{display:block;height:100%;transition:width .25s ease}
  #pgInfo{font-size:12px;margin-top:6px;color:#6b7280}

  /* FULL æ¨¡å¼ç¼ºè¯æ ‡çº¢ï¼ˆä¿ç•™ï¼‰ */
  mark.miss { color:#e11d48; background:transparent; font-weight:700; }

  /* â€”â€”â€”â€”â€” ğŸŒŸ æ»¡è´¯â€œæ•´åœˆé‡‘æ¡† + æµåŠ¨é«˜å…‰â€ï¼ˆå¸¸é©»ï¼Œç›´åˆ° resetï¼‰ â€”â€”â€”â€”â€” */

  @property --flow-pos { syntax: '<percentage>'; inherits: false; initial-value: 0%; }

  /* é‡‘æ¡†ç±»ï¼šä»…éšè—åŸè¾¹æ¡†ï¼›ä¸æ”¹å˜åŸèƒŒæ™¯/æ–‡å­—é¢œè‰²ï¼ˆä¸é®å·ï¼‰ */
  #qGrid button.gold-frame {
    border-color: transparent !important;
  }

  /* å®ä½“é‡‘æ¡†ï¼ˆå¸¸äº®ï¼‰ */
  #qGrid button.gold-frame::before{
    content:"";
    position:absolute;
    inset:-3px;
    border-radius:10px;
    padding:3px;
    background: linear-gradient(90deg,#f59e0b,#fbbf24,#fde68a,#facc15,#f59e0b);
    background-size: 200% 100%;
    -webkit-mask:
      linear-gradient(#000 0 0) content-box,
      linear-gradient(#000 0 0);
    -webkit-mask-composite: xor;
            mask-composite: exclude;
    pointer-events:none;
  }

  /* æµåŠ¨é«˜å…‰çº¹ç†ï¼ˆè¦†ç›–åœ¨é‡‘æ¡†ä¸Šï¼Œæ•´ä½“æµåŠ¨ï¼‰ */
  #qGrid button.gold-frame::after{
    content:"";
    position:absolute;
    inset:-3px;
    border-radius:10px;
    padding:3px;
    background:
      linear-gradient(90deg,
        rgba(255,255,255,0) 0%,
        rgba(255,255,255,0.35) 25%,
        rgba(255,255,255,0.65) 50%,
        rgba(255,255,255,0.35) 75%,
        rgba(255,255,255,0) 100%);
    background-size: 200% 100%;
    background-position: var(--flow-pos) 0%;
    mix-blend-mode: screen;
    -webkit-mask:
      linear-gradient(#000 0 0) content-box,
      linear-gradient(#000 0 0);
    -webkit-mask-composite: xor;
            mask-composite: exclude;
    animation: goldFlowMove 3.2s linear infinite;
    pointer-events:none;
  }

  @keyframes goldFlowMove { to { --flow-pos: 100%; } }

  /* é¦–æ¬¡è¾¾æˆè½»å¾®è„‰å†²ï¼ˆä¸€æ¬¡ï¼‰ */
  @keyframes starPulse {
    0%   { box-shadow: 0 0 0 0 rgba(250, 204, 21, 0.0); }
    50%  { box-shadow: 0 0 12px 4px rgba(250, 204, 21, 0.55); }
    100% { box-shadow: 0 0 0 0 rgba(250, 204, 21, 0.0); }
  }
  #qGrid button.gold-frame.celebrate { animation: starPulse 0.6s ease-in-out 3; }

  /* å‡å°‘åŠ¨æ€ï¼šé‡‘æ¡†å¸¸äº®ä½†ä¸æµåŠ¨ä¸è„‰å†² */
  @media (prefers-reduced-motion: reduce) {
    #qGrid button.gold-frame::after { animation: none; }
    #qGrid button.gold-frame.celebrate { animation: none; }
  }
</style>
</head>
<body>
<nav>
  <a href="../../index.html">Home</a>
  <a href="../../speaking/index.html">Speaking</a>
  <a href="../../writing/index.html">Writing</a>
  <a href="../../reading/index.html">Reading</a>
  <a href="../../listening/index.html">Listening</a>
</nav>

<main>
  <h1>Listening Â· WFD</h1>
  <div class="muted">Choose a mode to start practicing.</div>

  <!-- æ¨¡å¼ Tab -->
  <div class="toolbar" id="tabs">
    <div class="tab active" data-mode="fw">Function Words</div>
    <div class="tab" data-mode="cw">Content Words</div>
    <div class="tab" data-mode="full">Full Sentence</div>
  </div>

  <!-- ç»ƒä¹ å¡ç‰‡ -->
  <div class="card">
    <audio id="audio" controls></audio>

    <div id="prompt"></div>
    <div id="inputs"></div>

    <div class="row">
      <button class="ghost" id="prevBtn">Prev</button>
      <button id="checkBtn">Check</button>
      <button class="ghost" id="showBtn">Show Answer</button>
      <button class="ghost" id="resetBtn">Reset</button>
      <button class="ghost" id="nextBtn">Next</button>
    </div>

    <div class="progress"><span id="pgBar"></span></div>
    <div id="pgInfo" class="muted"></div>

    <div id="result"></div>
  </div>

  <!-- é¢˜å·å¯¼èˆª -->
  <div id="questionNav">
    <div class="title" id="navTitle">Question Navigator</div>
    <div class="grid" id="qGrid"></div>
  </div>
</main>

<!-- é¢˜åº“æ–‡ä»¶ï¼ˆä¸æœ¬é¡µåŒç›®å½•ï¼‰ -->
<script src="./data-fw.js"></script>
<script src="./data-cw.js"></script>
<script src="./data-full.js"></script>

<script>
/* éŸ³é¢‘æ ¹ç›®å½•ï¼šwfd.html åœ¨ listening/wfd/ï¼›éŸ³é¢‘åœ¨ listening/audio/ */
const AUDIO_BASE = "../audio/";

/* â€”â€” çŠ¶æ€ â€”â€” */
let mode = "fw";       // fw | cw | full
let list = [];
let idx  = 0;

const $ = s => document.querySelector(s);

/* è§„èŒƒåŒ–ä¸åˆ†è¯ */
const norm = s => (s||"").trim().toLowerCase()
  .replace(/[.,!?;:"'â€™â€â€œ()[\]]/g,"").replace(/\s+/g," ");
const resultKey = (m,id) => `wfd_${m}_result_${id}`;
const countHoles = s => ((s||"").match(/___/g) || []).length;

/* FULL è¯é¢‘ */
const wordOnlyTokens = s => (s||"").toLowerCase().match(/[a-z']+/g) || [];
const freqMap = tokens => { const m=new Map(); for(const t of tokens)m.set(t,(m.get(t)||0)+1); return m; };

/* â€”â€” å·¥å…·ï¼šæ ¹æ® id å®šä½ / æ¯æ¨¡å¼è®°å¿† idx â€”â€” */
const lastIdxKey = m => `wfd_last_idx_${m}`;

function findIndexById(arr, id) {
  if (!id || !arr || !arr.length) return -1;
  return arr.findIndex(x => String(x.id) === String(id));
}

function rememberIdx() {
  const item = list[idx];
  if (!item) return;
  localStorage.setItem(lastIdxKey(mode), String(idx));
}

function restoreIdxForMode(m, arr, fallbackId) {
  // 1) ä¼˜å…ˆï¼šåŒé¢˜ id
  if (fallbackId) {
    const k = findIndexById(arr, fallbackId);
    if (k >= 0) return k;
  }
  // 2) å…¶æ¬¡ï¼šè¯¥æ¨¡å¼ä¸Šæ¬¡åœç•™ idx
  const saved = localStorage.getItem(lastIdxKey(m));
  const k = Number.isInteger(+saved) ? +saved : 0;
  if (k >= 0 && k < arr.length) return k;
  // 3) å¦åˆ™ï¼š0
  return 0;
}

function judgeFULL(answerText, userText){
  const need = freqMap(wordOnlyTokens(answerText));
  const have = freqMap(wordOnlyTokens(userText));
  for (const [w, cnt] of need.entries()) if ((have.get(w) || 0) < cnt) return false;
  return true;
}

/* Show Answer ç¼ºè¯æ ‡çº¢ */
const wordTokens = s => (s.match(/[A-Za-z']+|[^A-Za-z']+/g) || []);
function highlightMissingInAnswer(answerText, userText){
  const need = freqMap(wordOnlyTokens(answerText));
  const have = freqMap(wordOnlyTokens(userText));
  const seen = new Map();
  return (wordTokens(answerText)).map(tok=>{
    if(!/^[A-Za-z']+$/.test(tok)) return tok;
    const key = tok.toLowerCase();
    const totalNeed = need.get(key) || 0;
    if (!totalNeed) return tok;
    const k = (seen.get(key) || 0) + 1; seen.set(key,k);
    const haveCnt = have.get(key) || 0;
    return (k>haveCnt) ? `<mark class="miss">${tok}</mark>` : tok;
  }).join('');
}

/* FW/CWï¼šç‹¬ç«‹è¯åŒ¹é…ï¼ˆå¤šå†™ä¸ç½šï¼‰ */
function escapeRegExp(s){ return (s||'').replace(/[.*+?^${}()|[\]\\]/g,'\\$&'); }
function findWordMatch(hay, needle){
  const re = new RegExp(`\\b${escapeRegExp(needle)}\\b`, 'i');
  const m = (hay || '').match(re);
  return m ? m[0] : null;
}

/* â€”â€” è§£é”è¿›åº¦ï¼ˆä¿ç•™ï¼Œä»¥é©±åŠ¨è¿›åº¦æ¡ï¼‰ â€”â€” */
const unlockKey = id => `wfd_unlock_${id}`;
function getUnlockedSet(id){
  try{ const arr = JSON.parse(localStorage.getItem(unlockKey(id))||"[]"); return new Set(arr.map(x=>String(x).toLowerCase())); }
  catch{ return new Set(); }
}
function saveUnlockedSet(id,set){ localStorage.setItem(unlockKey(id), JSON.stringify([...set])); }
function addUnlockedWords(id, words){
  const s = getUnlockedSet(id);
  words.forEach(w=>{ if(w) s.add(String(w).toLowerCase()); });
  saveUnlockedSet(id, s);
}

/* ğŸŒŸ æ»¡è´¯åˆ¤å®šã€åº†ç¥ä¸â€œå¸¸é©»é‡‘æ¡†â€æŒä¹…åŒ– */
const starCelebrateKey = id => `wfd_star_celebrated_${id}`; // é¦–æ¬¡è„‰å†²å·²æ’­
const starPersistKey   = id => `wfd_star_persist_${id}`;     // å¸¸é©»é‡‘æ¡†æ ‡è®°ï¼ˆ1=å¸¸é©»ï¼‰

function hasLiveFullPass(id){
  const fw   = localStorage.getItem(resultKey('fw',   id));
  const cw   = localStorage.getItem(resultKey('cw',   id));
  const full = localStorage.getItem(resultKey('full', id));
  return fw === 'correct' && cw === 'correct' && full === 'correct';
}

/* è¿›åº¦æ¡ï¼ˆä¿ç•™ï¼‰ */
function renderProgress(){
  const item = list[idx]; if(!item) return;
  const unlocked = getUnlockedSet(item.id);
  const total = wordTokens(item.answer).filter(w=>/^[A-Za-z']+$/.test(w)).length || 1;
  const done = unlocked.size;
  const pct = Math.min(100, Math.round(done*100/total));
  $("#pgBar").style.width = pct + "%";
  $("#pgBar").style.background = pct >= 100 ? "#10b981" : "#0f62fe";
  $("#pgInfo").textContent = `Progress: ${done}/${total} (${pct}%)`;
}

/* Tab */
$("#tabs").addEventListener("click", e=>{
  const t = e.target.closest(".tab"); if(!t) return;

  // è®°å½•å½“å‰é¢˜ç›®çš„ idï¼Œä¾›åˆ‡æ¢åå¯¹é½
  const currentItem = list[idx];
  const currentId = currentItem ? currentItem.id : null;

  // åˆ‡æ¢æ¨¡å¼
  mode = t.dataset.mode;
  [...$("#tabs").children].forEach(x=>x.classList.toggle("active", x===t));

  // é‡å»ºåˆ—è¡¨ï¼Œä½†æŒ‰åŒé¢˜ id / è®°å¿† idx è¿˜åŸé¢˜å·
  rebuild(currentId);
});

/* æŒ‰é’® */
$("#checkBtn").addEventListener("click", onCheck);
$("#showBtn").addEventListener("click", onShow);
$("#resetBtn").addEventListener("click", onResetAll);
$("#prevBtn").addEventListener("click", ()=>{
  if(!list.length) return;
  idx=(idx-1+list.length)%list.length;
  rememberIdx();
  render(); renderNav();
});
$("#nextBtn").addEventListener("click", ()=>{
  if(!list.length) return;
  idx=(idx+1)%list.length;
  rememberIdx();
  render(); renderNav();
});

/* è½½å…¥é¢˜åº“ */
function rebuild(fallbackId=null){
  const MAP = { fw: (window.DATA_FW||[]), cw: (window.DATA_CW||[]), full: (window.DATA_FULL||[]) };
  list = MAP[mode] || [];
  idx = restoreIdxForMode(mode, list, fallbackId);

  if(!list.length) renderEmpty(); else render();
  renderNav();
}

/* ç©ºæ€ */
function renderEmpty(){
  $("#audio").src = "";
  $("#prompt").textContent = "";
  $("#inputs").innerHTML = "";
  $("#result").innerHTML = `<span style="color:#b45309">No items found.</span>`;
  $("#navTitle").textContent = "Question Navigator Â· 0 items";
  $("#qGrid").innerHTML = "";
  renderProgress();
}

/* æ¸²æŸ“é¢˜é¢ */
function render(){
  $("#result").textContent = "";
  const item = list[idx]; if(!item) return renderEmpty();

  $("#audio").src = AUDIO_BASE + (item.audio || "");
  $("#prompt").textContent = item.prompt || "";
  $("#inputs").innerHTML = "";

  if (mode === "full") {
    const input = document.createElement("input");
    input.type = "text";
    input.placeholder = "Type what you hear...";
    input.className = "full";
    $("#inputs").appendChild(input);
  } else {
    const wrap = document.createElement("div");
    const holes = countHoles(item.prompt || "");
    const n = holes > 0 ? holes : (item.blanks || []).length;
    for (let i = 0; i < n; i++){
      const inp = document.createElement("input");
      inp.type = "text";
      inp.className = "input-blank";
      wrap.appendChild(inp);
    }
    $("#inputs").appendChild(wrap);
  }

  renderProgress();
}

/* å¯¼èˆªï¼šåŸçŠ¶æ€è‰² + é‡‘æ¡†å¸¸é©»ï¼ˆåŸºäºæŒä¹…æ ‡è®°ï¼‰ï¼Œæ–°è¾¾æˆå³å†™å…¥å¹¶è„‰å†²ä¸€æ¬¡ */
function renderNav(){
  const N = list.length;
  $("#navTitle").textContent = `Question Navigator Â· ${N} item${N>1?'s':''}`;
  const grid = $("#qGrid");
  grid.innerHTML = "";

  list.forEach((item, i) => {
    const state = localStorage.getItem(resultKey(mode, item.id)); // correct | wrong | warn
    let border="#ccc", bg="#f4f4f4", col="#333";
    if (i===idx){ border="#0f62fe"; bg="#e6f0ff"; col="#0f62fe"; }
    else if (state==="correct"){ border="#28a745"; bg="#e6f9ec"; col="#28a745"; }
    else if (state==="warn"){ border="#b45309"; bg="#fff8e1"; col="#b45309"; }
    else if (state==="wrong"){ border="#dc3545"; bg="#fdecea"; col="#dc3545"; }

    const btn=document.createElement("button");
    btn.textContent=i+1;
    btn.style.border=`2px solid ${border}`;
    btn.style.background=bg;
    btn.style.color=col;

    // è‹¥æœ¬é¢˜å°šæœªå¸¸é©»é‡‘æ¡†ï¼Œä½†â€œå½“å‰å®æ—¶çŠ¶æ€â€é¦–æ¬¡è¾¾åˆ°æ»¡è´¯ â†’ å†™å…¥å¸¸é©»æ ‡è®°ï¼Œå¹¶è§¦å‘ä¸€æ¬¡è„‰å†²
    const persisted = localStorage.getItem(starPersistKey(item.id)) === '1';
    if (!persisted && hasLiveFullPass(item.id)) {
      localStorage.setItem(starPersistKey(item.id), '1');
      // è®°å½•å·²åº†ç¥ï¼Œé¿å…é‡å¤
      if (localStorage.getItem(starCelebrateKey(item.id)) !== '1') {
        btn.classList.add('celebrate');
        btn.addEventListener('animationend', () => {
          btn.classList.remove('celebrate');
          localStorage.setItem(starCelebrateKey(item.id), '1');
        }, { once: true });
      }
    }

    // åªè¦å¸¸é©»æ ‡è®°å­˜åœ¨ï¼Œå°±æ˜¾ç¤ºé‡‘æ¡†ï¼ˆæ— è®ºå½“å‰æ˜¯å¦ä»ç„¶æ»¡è¶³æ»¡è´¯ï¼‰
    if (localStorage.getItem(starPersistKey(item.id)) === '1') {
      btn.classList.add('gold-frame');
    }

    btn.addEventListener("click",()=>{
      idx=i;
      rememberIdx();
      render();
      renderNav();
    });
    grid.appendChild(btn);
  });
}

/* é¦–å­—æ¯å¤§å°å†™æ£€æµ‹ï¼ˆéé˜»æ–­ï¼‰ */
function firstLetterCaseMismatch(userStr, ansStr){
  const um = (userStr || "").match(/[A-Za-z]/);
  const am = (ansStr  || "").match(/[A-Za-z]/);
  if (!um || !am) return false;
  const uc = um[0], ac = am[0];
  if (uc.toLowerCase() !== ac.toLowerCase()) return false;
  return uc !== ac;
}

/* åˆ¤é¢˜ */
function onCheck(){
  const item = list[idx]; if (!item) return;
  $("#inputs").querySelectorAll(".mark").forEach(m=>m.remove());

  if (mode === "full") {
    const input = $("#inputs input.full");
    const user = (input.value || "").trim();
    const ans  = (item.answer || "").trim();

    const pass = judgeFULL(ans, user);
    if (pass) {
      if (firstLetterCaseMismatch(user, ans)) {
        $("#result").innerHTML = "âš ï¸ Spelling correct, but check capitalization of the first letter.";
        localStorage.setItem(resultKey(mode, item.id), "warn");
      } else {
        $("#result").textContent = "âœ… Correct";
        localStorage.setItem(resultKey(mode, item.id), "correct");
      }
    } else {
      $("#result").textContent = "âŒ Try again";
      localStorage.setItem(resultKey(mode, item.id), "wrong");
    }

  } else {
    // FW / CWï¼šåŒ…å«ç›®æ ‡è¯å³å¯ï¼ˆå¤šå†™ä¸ç½šï¼›ç‹¬ç«‹è¯è¾¹ç•Œï¼‰
    const ins = [...$("#inputs").querySelectorAll("input.input-blank")];
    const expected = (item.blanks || []);
    const answers = expected.slice(0, ins.length);
    while (answers.length < ins.length) answers.push("");

    let allOK = true, anyWarn = false;
    const toUnlock = [];

    ins.forEach((inp, k)=>{
      const user = (inp.value || "").trim();
      const ans  = (answers[k] || "").trim();

      const matched = findWordMatch(user, ans);
      const ok = !!matched;
      const warn = ok && firstLetterCaseMismatch(matched, ans);

      if (ok) toUnlock.push(ans);

      const mark = document.createElement("span");
      mark.className = "mark";
      mark.style.marginLeft = "6px";
      mark.style.fontWeight = "bold";

      if (ok && !warn) { mark.style.color = "green"; mark.textContent = "âœ”"; }
      else if (ok && warn){ mark.style.color = "#b45309"; mark.textContent = "!"; anyWarn = true; }
      else { mark.style.color = "red"; mark.textContent = "âœ˜"; allOK = false; }

      inp.after(mark);
    });

    if (toUnlock.length) addUnlockedWords(item.id, toUnlock);
    renderProgress();

    if (allOK) {
      $("#result").textContent = "âœ… All blanks correct!";
      localStorage.setItem(resultKey(mode, item.id), "correct");
    } else if (!allOK && anyWarn && !ins.some((inp, k)=>!findWordMatch((inp.value||"").trim(), (answers[k]||"").trim()))) {
      $("#result").innerHTML = "âš ï¸ Spelling correct, but check capitalization (first letter).";
      localStorage.setItem(resultKey(mode, item.id), "warn");
    } else {
      $("#result").textContent = "âŒ Some blanks are wrong";
      localStorage.setItem(resultKey(mode, item.id), "wrong");
    }
  }

  rememberIdx();
  renderNav(); // è¯„åˆ¤åç«‹å³åˆ·æ–°å¯¼èˆªï¼ˆè‹¥é¦–æ¬¡æ»¡è´¯åˆ™è½åº“å¹¶æ˜¾ç¤ºé‡‘æ¡†ï¼‰
}

/* çœ‹ç­”æ¡ˆ */
function onShow(){
  const item = list[idx]; if (!item) return;
  if (mode === "full") {
    const input = $("#inputs input.full");
    const user = (input?.value || "").trim();
    const highlighted = highlightMissingInAnswer(item.answer || "", user || "");
    $("#result").innerHTML = `Answer: <span class="answer">${highlighted}</span>`;
  } else {
    $("#result").innerHTML = `Answer: <span class="answer">${item.answer}</span>`;
  }
}

/* é‡ç½®ï¼ˆæ¸…æ‰æœ¬æ¨¡å¼è®°å½• & å¸¸é©»é‡‘æ¡†æ ‡è®° & è„‰å†²è®°å½•ï¼‰ */
function onResetAll(){
  list.forEach(item=>{
    localStorage.removeItem(resultKey(mode, item.id));
    localStorage.removeItem(starPersistKey(item.id));   // â† ä»… Reset æ—¶æ‰ç§»é™¤å¸¸é©»é‡‘æ¡†
    localStorage.removeItem(starCelebrateKey(item.id)); // å…è®¸ä¸‹æ¬¡å†æ¬¡è„‰å†²
  });
  localStorage.removeItem(lastIdxKey(mode)); // æ¸…é™¤è¯¥æ¨¡å¼çš„â€œä¸Šæ¬¡é¢˜å·â€è®°å¿†
  idx = 0;
  render();
  renderNav();
  $("#result").textContent = "";
  renderProgress();
}

/* å¯åŠ¨ */
rebuild();
</script>
</body>
</html>
